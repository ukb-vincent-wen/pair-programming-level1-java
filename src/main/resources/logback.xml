<configuration>
   <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
      <encoder>
         <pattern>%d{ISO8601} %-5level [%thread] %X{trace-id} %X{username} %logger{36} - %msg %rEx{full,
            jakarta.servlet.http.HttpServlet,
            org.apache.catalina.core.ApplicationFilterChain,
            org.apache.tomcat.util.threads,
            org.apache.coyote}%n</pattern>
      </encoder>
   </appender>
   <logger name="org.springframework" level="INFO" />

   <if condition='isDefined("DEV_LOGGING")'>
      <if condition='!isDefined("DEV_LOGGING_HOME")'>
         <then>
            <property name="DEV_LOGGING_HOME" value="${user.home}/logs"/>
         </then>
      </if>
      <appender name="ROLLING" class="ch.qos.logback.core.rolling.RollingFileAppender">
         <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${DEV_LOGGING_HOME}/ams-%d{yyyy-MM-dd}-%i.log</fileNamePattern>
            <maxFileSize>10MB</maxFileSize>
            <maxHistory>30</maxHistory>
            <totalSizeCap>1GB</totalSizeCap>
         </rollingPolicy>
         <encoder>
            <pattern>%d{ISO8601} %-5level [%thread] %X{trace-id} %X{principal} %logger{36} - %msg %rEx{full,
               jakarta.servlet.http.HttpServlet,
               org.apache.catalina.core.ApplicationFilterChain,
               org.apache.tomcat.util.threads,
               org.apache.coyote}%n</pattern>
         </encoder>
      </appender>

      <root level="debug">
         <appender-ref ref="ROLLING"/>
      </root>
   </if>

   <root level="debug">
      <appender-ref ref="STDOUT"/>
   </root>
</configuration>
